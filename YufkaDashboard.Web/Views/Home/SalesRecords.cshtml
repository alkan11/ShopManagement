
@{
	ViewData["Title"] = "EndDay";
	Layout = "~/Views/Shared/_Layout2.cshtml";
	var salesRecord = ViewBag.SalesRecord != null ? ViewBag.SalesRecord as IEnumerable<Shared.Models.Home.RepeaterFormModel> : null;
}
<div id="kt_header" class="header" data-kt-sticky="true" data-kt-sticky-name="header" data-kt-sticky-offset="{default: '200px', lg: '300px'}">
	<div class="container-xxl d-flex align-items-center justify-content-between" id="kt_header_container">
		<!--begin::Page title-->
		<div class="page-title d-flex flex-column align-items-start justify-content-center flex-wrap mt-n5 mt-lg-0 me-lg-2 pb-2 pb-lg-0" data-kt-swapper="true" data-kt-swapper-mode="prepend" data-kt-swapper-parent="{default: '#kt_content_container', lg: '#kt_header_container'}">
			<!--begin::Heading-->
			<h1 class="text-dark fw-bold my-0 fs-2">Ürün Yönetimi</h1>
			<!--end::Heading-->
			<ol class="breadcrumb text-muted fs-6 fw-semibold" style="margin-top:10px;">
				<li class="breadcrumb-item"><a href="@Url.Action("Index","Home")" class="">Ana Sayfa</a></li>
				<li class="breadcrumb-item text-muted">Satış Kayıt Listesi</li>
			</ol>
		</div>
		<!--end::Toolbar wrapper-->
	</div>
</div>
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
	<!--begin::Container-->
	<div class="container-xxl" id="kt_content_container">
		<!--begin::Row-->
		<div class="row g-5 g-xl-10 mb-xl-10">
			<div class="col-xl-15 mb-5 mb-xl-10">
				<!--begin::Table Widget 4-->
				<div class="card card-flush h-xl-100">
					<!--begin::Card header-->
					<div class="card-header pt-7">
						<!--begin::Title-->
						<h3 class="card-title align-items-start flex-column">
							<span class="card-label fw-bold text-gray-800">Satış Kayıtları</span>
						</h3>
						<!--end::Title-->
						<!--begin::Actions-->
						<div class="card-toolbar">
							<!--begin::Filters-->
							<div class="d-flex flex-stack flex-wrap gap-4">
								<!--begin::Search-->

								<div class="position-relative my-1">
									<!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
									<span class="svg-icon svg-icon-2 position-absolute top-50 translate-middle-y ms-4">
										<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="currentColor" />
											<path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z" fill="currentColor" />
										</svg>
									</span>
									<!--end::Svg Icon-->

									<input type="text" data-kt-table-widget-4="search" class="form-control w-150px fs-7 ps-12" placeholder="Ara" />
								</div>
								<!--end::Search-->
							</div>

							<!--begin::Filters-->
						</div>
						<!--end::Actions-->
					</div>
					<!--end::Card header-->
					<!--begin::Card body-->
					<div class="card-body pt-2">
						<!--begin::Table-->
						<table class="table align-middle table-row-dashed fs-6 gy-3" id="kt_docs_datatable_subtable">
							<!--begin::Table head-->
							<thead>
								<!--begin::Table row-->
								<tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
									<th class="min-w-100px">Satış No</th>
									<th class="text-end min-w-100px">Satış Tarihi</th>
									<th class="text-end min-w-100px">Genel Toplam</th>
									<th class="text-end min-w-50px">Durumu</th>
									<th class="text-end"></th>
								</tr>
								<!--end::Table row-->
							</thead>
							<!--end::Table head-->
							<!--begin::Table body-->
							<tbody class="fw-bold text-gray-600">
								@if (salesRecord != null)
								{
									foreach (var item in salesRecord)
									{

										<tr>
											<td>
												<a class="text-gray-800 text-hover-primary">@item.Id</a>
											</td>
											<td class="text-end">@item.CreatedDate</td>
											<td class="text-end">
												<span class="text-gray-800 fw-bolder">@item.TotalPrice Tl</span>
											</td>
											<td class="text-end">
												@if (item.Status == 1)
												{
													<span class="badge py-3 px-4 fs-7 badge-light-primary">Gerçekleşti</span>
												}
												else
												{
													<span class="badge py-3 px-4 fs-7 badge-light-danger">İptal</span>
												}

											</td>
											<td class="text-end">
												<button type="button" class="btn btn-sm btn-icon btn-light btn-active-light-primary toggle h-25px w-30px" subtable="expand_row" itemid="@item.Id">
													<!--begin::Svg Icon | path: icons/duotune/arrows/arr087.svg-->
													<span class="svg-icon svg-icon-3 m-0 toggle-off">
														<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
															<rect opacity="0.5" x="11" y="18" width="12" height="2" rx="1" transform="rotate(-90 11 18)" fill="currentColor" />
															<rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor" />
														</svg>
													</span>
													<!--end::Svg Icon-->
													<!--begin::Svg Icon | path: icons/duotune/arrows/arr089.svg-->
													<span class="svg-icon svg-icon-3 m-0 toggle-on">
														<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
															<rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor" />
														</svg>
													</span>
													<!--end::Svg Icon-->
												</button>
											</td>
											@*<td class="text-end">
												<button type="button" class="btn btn-sm btn-icon btn-light btn-active-light-primary toggle h-25px w-40px" onclick="DeleteBasket(@item.Id)" itemid="@item.Id">
													<span class="badge py-3 px-4 fs-7 badge-light-danger">Sil</span>
												</button>
											</td>*@
										</tr>
										<tr subtable="subtable_template" class="none" style="display:none">
											@foreach (var subItem in item.Baskets)
											{
											<tr id="sub" class="none" itemid="@item.Id" style="display:none">
												<td colspan="1">
													<div class="d-flex align-items-center gap-3">
														<div class="d-flex flex-column text-muted">
															<a href="#" class="text-gray-800 text-hover-primary fw-bold" widget-4="template_name">@subItem.ProductIdName</a>

														</div>
													</div>
												</td>
												<td class="text-end">
													<div class="text-gray-800 fs-7">Miktar</div>
													<div class="text-muted fs-7 fw-bold" widget-4="template_cost">@subItem.Amount</div>
												</td>
												<td class="text-end">
													<div class="text-gray-800 fs-7">Tutar</div>
													<div class="text-muted fs-7 fw-bold" widget-4="template_qty">@subItem.Price TL</div>
												</td>
												<td class="text-end">
													<div class="text-gray-800 fs-7">Durumu</div>
														@if (subItem.Status == 1)
														{
														<div class="badge badge-light-success">Gerçekleşti</div>
														}
														else
														{
														<div class="badge badge-light-danger">İptal</div>
														}
												</td>
												@*<td class="text-end">
														@if (item.Baskets.Count > 1)
														{
														<button type="button" class="btn btn-sm btn-icon btn-light btn-active-light-primary toggle h-25px w-40px" onclick="DeleteSubItem(@subItem.BasketDetailId)" itemid="@subItem.BasketDetailId">
															<span class="badge py-3 px-4 fs-7 badge-light-danger">Sil</span>
														</button>
														}

												</td>*@
											</tr>
											}
										</tr>

									}

								}

							</tbody>
							<!--end::Table body-->
						</table>
						<!--end::Table-->
					</div>
					<!--end::Card body-->
				</div>
				<!--end::Table Widget 4-->
			</div>
		</div>

	</div>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function () {

		// Toggle button için click event listener
		document.querySelectorAll('[subtable="expand_row"]').forEach(function (button) {
			button.addEventListener("click", function () {
				// Tıklanan satırın üst satırdaki "subtable_template" olan `tr`'yi bulma
				const parentRow = this.closest("tr");
				const subTableRow = parentRow.nextElementSibling;

				var rowId = this.getAttribute("itemid");

				if (subTableRow && subTableRow.getAttribute("subtable") === "subtable_template") {

					if (subTableRow.classList.contains("isOpen")) {

						subTableRow.classList.remove("isOpen");
						subTableRow.style.display = "none";

						document.querySelectorAll('tr[id="sub"][itemId="' + rowId + '"]').forEach(row => {
							row.classList.remove("isOpen");
							row.style.display = "none"; // Gizle
						});

					} else {
						subTableRow.classList.add("isOpen");
						subTableRow.style.display = "table-row";

						document.querySelectorAll('tr[id="sub"][itemId="' + rowId + '"]').forEach(row => {
							row.classList.add("isOpen");
							row.style.display = "table-row"; // Aç
						});
					}
				}
			});
		});
	});
</script>
